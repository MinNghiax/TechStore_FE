<h2>Qu·∫£n l√Ω ƒë∆°n h√†ng</h2>
<!-- Modal C·∫≠p nh·∫≠t ƒë∆°n h√†ng -->
<div class="modal fade" id="addModal" tabindex="-1"
  aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addModalLabel">C·∫≠p nh·∫≠t ƒë∆°n h√†ng</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"
          aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form *ngIf="selected" (ngSubmit)="suaDonHang()"
          style="display: flex; flex-direction: column; gap: 10px;">
          <label>
            T√™n kh√°ch h√†ng:
            <input type="text" [(ngModel)]="customer_name" name="customer_name"
              readonly />
          </label>
          <label>
            Tr·∫°ng th√°i ƒë∆°n h√†ng:
            <select [(ngModel)]="order_status" name="order_status">
              <option [value]="order_status">{{ order_status }}</option>
              <option *ngFor="let status of orderStatuses[order_status]"
                [value]="status">{{ status }}</option>
            </select>
          </label>
          <label>
            Ng√†y ƒë·∫∑t h√†ng:
            <input type="date" [(ngModel)]="create_at" name="create_at"
              required />
          </label>
          <label>
            T·ªïng ti·ªÅn:
            <input type="number" [(ngModel)]="total_amount" name="total_amount"
              required />
          </label>
          <label>
            ƒê·ªãa ch·ªâ:
            <input type="text" [(ngModel)]="address" name="address" />
          </label>
          <label>
            S·ªë ƒëi·ªán tho·∫°i:
            <input type="tel" [(ngModel)]="phone" name="phone"
              pattern="[0-9]{10}" />
          </label>
          <label>
            Ph∆∞∆°ng th·ª©c thanh to√°n:
            <select [(ngModel)]="payment_method" name="payment_method">
              <option value="Cash">Ti·ªÅn m·∫∑t</option>
              <option value="Banking">Chuy·ªÉn kho·∫£n</option>
              <option value="COD">Thanh to√°n khi nh·∫≠n h√†ng</option>
            </select>
          </label>
          <button type="submit"
            style="margin-top: 20px; padding: 6px 12px; background-color: #d9534f; color: white; border: none; border-radius: 4px;">
            C·∫≠p nh·∫≠t
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="product-actions">
  <div class="create-button">
    <button class="btn btn-danger"
      style="margin-left:50px;margin-top:10px"
      data-bs-toggle="modal"
      data-bs-target="#exampleModal"
      (click)="resetForm()">+ Th√™m ƒë∆°n h√†ng</button>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1"
      aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form #orderForm="ngForm" (ngSubmit)="addProductToOrder(orderForm)"
          class="modal-content">

          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Th√™m ƒë∆°n
              h√†ng</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal"
              aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Kh√°ch h√†ng</label>
              <select class="form-select"
                name="user_id"
                required
                [(ngModel)]="user_id">
                <option value disabled selected>-- Ch·ªçn kh√°ch h√†ng --</option>
                <option *ngFor="let u of DSUser" [value]="u.user_id">{{
                  u.username }}</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">S·∫£n ph·∫©m</label>
              <select class="form-select"
                name="product_id"
                required
                [(ngModel)]="product_id"
                (change)="layDetailsSP(product_id)">
                <option value disabled>-- Ch·ªçn s·∫£n ph·∫©m --</option>
                <option *ngFor="let p of DsProduct" [value]="p.product_id">{{
                  p.product_name }}</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">ƒê·ªãa ch·ªâ giao h√†ng</label>
              <input class="form-control"
                name="address"
                required
                [(ngModel)]="address"
                placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng">
            </div>

            <div class="mb-3">
              <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
              <input class="form-control"
                name="phone"
                required
                pattern="[0-9]{10}"
                [(ngModel)]="phone"
                placeholder="Nh·∫≠p 10 s·ªë ƒëi·ªán tho·∫°i">
            </div>

            <div class="mb-3">
              <label class="form-label">Ph∆∞∆°ng th·ª©c thanh to√°n</label>
              <select class="form-select"
                name="payment_method"
                required
                [(ngModel)]="payment_method">
                <option value disabled selected>-- Ch·ªçn ph∆∞∆°ng th·ª©c --</option>
                <option value="bank_transfer">Chuy·ªÉn kho·∫£n</option>
                <option value="cash_on_delivery">Thanh to√°n khi nh·∫≠n
                  h√†ng</option>
              </select>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary"
              data-bs-dismiss="modal">ƒê√≥ng</button>
            <button type="submit"
              class="btn btn-primary"
              [disabled]="orderForm.invalid || isLoading">
              {{ isLoading ? 'ƒêang l∆∞u...' : 'Th√™m' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Search Section -->
<div class="row mb-3">
  <div class="col-md-6">
    <input type="text" class="form-control" [(ngModel)]="searchText" />
    <button type="button" (click)="timkiem()"><i class="fas fa-search"></i> T√¨m
      ki·∫øm</button>
  </div>
</div>

<!-- Orders Table -->
<div class="container mt-3">
  <table class="table table-hover">
    <thead>
      <tr>
        <th>M√£ ƒë∆°n h√†ng</th>
        <th>T√™n kh√°ch h√†ng</th>
        <th>Tr·∫°ng th√°i ƒë∆°n h√†ng</th>
        <th>Ng√†y ƒë·∫∑t h√†ng</th>
        <th>T·ªïng gi√° tr·ªã</th>
        <th>Thao t√°c</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let donhang of (orderSearch.length > 0 ? orderSearch : DSDonHang)">
        <td data-label="M√£ ƒë∆°n h√†ng">{{ donhang.order_id }}</td>
        <td data-label="T√™n kh√°ch h√†ng">{{ donhang.full_name }}</td>
        <td>
          <select [(ngModel)]="donhang.selectedStatus"
            name="status_{{donhang.order_id}}" [disabled]="isLoading">
            <option [value]="donhang.order_status">{{ donhang.order_status}}</option>
            <option *ngFor="let status of orderStatuses[donhang.order_status]" [value]="status">{{ status }}</option>
          </select>
          <button *ngIf="!isLoading" type="button"
            class="btn btn-primary btn-sm" style="margin: 0 0 5px 5px;"
            (click)="updateOrderStatus(donhang.order_id, donhang.selectedStatus)"
            [disabled]="isLoading || donhang.selectedStatus === donhang.order_status">
            <i class="fas fa-save"></i> C·∫≠p nh·∫≠t
          </button>
          <div *ngIf="isLoading" class="loader" style="margin: auto;"></div>
        </td>
        <td>{{ donhang.create_at | date:'MM/dd/yyyy' }}</td>
        <td>{{ donhang.total_amount | currency:'VND':'symbol':'1.0-0' }}</td>
        <td class="sua-xoa">
          <button type="button" class="btn btn-info" data-bs-toggle="modal"
            data-bs-target="#detailModal"
            (click)="xemChiTietDon(donhang.order_id)">
            <i class="fas fa-eye"></i>
          </button>
          <button type="button" class="btn btn-danger" data-bs-toggle="modal"
            data-bs-target="#addModal" (click)="editDonhang(donhang)">
            <i class="fas fa-pen"></i>
          </button>
          <button type="button" class="btn btn-warning"
            (click)="xoaDsDonhang(donhang)" style="margin-left: 10px;">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Modal Chi ti·∫øt ƒë∆°n h√†ng -->
<div class="modal fade" id="detailModal" tabindex="-1"
  aria-labelledby="detailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content p-3">
      <div class="modal-header"
        style="background-color: #0d6efd; color: white;">
        <h5 class="modal-title">Chi ti·∫øt ƒë∆°n h√†ng</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"
          aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <h5>Th√¥ng tin ng∆∞·ªùi nh·∫≠n</h5>
            <p><strong>üë§ H·ªç t√™n:</strong> {{ currentOrder?.full_name }}</p>
            <p><strong>üìû SƒêT:</strong> {{ currentOrder?.phone }}</p>
            <p><strong>üè† ƒê·ªãa ch·ªâ:</strong> {{ currentOrder?.address }}</p>
            <p><strong>üí≥ Thanh to√°n:</strong> {{ currentOrder?.payment_method
              }}</p>
          </div>
          <div class="col-md-6">
            <h5>Th√¥ng tin v·∫≠n chuy·ªÉn</h5>
            <p>üöö ƒê∆°n v·ªã giao h√†ng: Giao H√†ng Nhanh</p>
            <p>üë®‚Äçüíº Shipper: Nguy·ªÖn Ng·ªçc M·∫°nh</p>
            <p>üìû SƒêT: 0779421219</p>
          </div>
        </div>
        <hr>
        <h5>S·∫£n ph·∫©m trong ƒë∆°n h√†ng</h5>
        <div class="table-responsive">
          <table class="table table-bordered text-center align-middle">
            <thead class="table-primary">
              <tr>
                <th>·∫¢nh</th>
                <th>S·∫£n ph·∫©m</th>
                <th>ƒê∆°n gi√°</th>
                <th>S·ªë l∆∞·ª£ng</th>
                <th>Th√†nh ti·ªÅn</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of DSChiTietDonHang">
                <td>
                  <img
                    [src]="productService.PhotosUrl + '/' + item.product?.image_url"
                    alt="·∫¢nh s·∫£n ph·∫©m" width="70">
                </td>
                <td>{{ item.product_name }}</td>
                <td>{{ item.price | currency:'VND' }}</td>
                <td>{{ item.number_of_products }}</td>
                <td>{{ item.total_money | currency:'VND' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="mt-3 text-end">
          <h5><strong>T·ªïng ti·ªÅn:</strong> {{ currentOrder?.total_amount |
            currency:'VND' }}</h5>
        </div>
      </div>
    </div>
  </div>
</div>